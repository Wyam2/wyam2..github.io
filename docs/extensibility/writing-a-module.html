<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <title>Wyam2 - Writing a Module</title>
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/override.css" rel="stylesheet">
        <script src="/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>        
        <script src="/assets/js/app.min.js"></script>         
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/assets/js/mermaid.min.js"></script>
        <script src="/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/assets/js/html5shiv.min.js"></script>
        <script src="/assets/js/respond.min.js"></script>
        <![endif]-->  

        <meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/" class="logo">

                                <!-- mini logo for sidebar mini 50x50 pixels -->
                                <span class="logo-mini"><img src="/assets/img/logo.png"></span>
                                <!-- logo for regular state and mobile devices -->
                                <span class="logo-lg"><img src="/assets/img/logo.png"></span>
                                            </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li><a href="/blog">Blog</a></li>
        <li class="active"><a href="/docs">Documentation</a></li>
        <li><a href="/recipes">Recipes</a></li>
        <li><a href="/modules">Modules</a></li>
        <li><a href="/shortcodes">Shortcodes</a></li>
        <li><a href="/api">API</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
        <div><p><a href="https://github.com/Wyam2/docs/tree/master/input/docs/extensibility/writing-a-module.md"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit Content</a></p></div>
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#create-a-library">Create a Library</a></p>
<p><a href="#create-a-module-class">Create a Module Class</a></p>
<p><a href="#implement-the-execute-method">Implement The Execute Method</a></p>
<p><a href="#deployment">Deployment</a></p>
<p><a href="#example">Example</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/docs/concepts">Concepts</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/concepts/documents">Documents</a></li>
                <li><a href="/docs/concepts/metadata">Metadata</a></li>
                <li><a href="/docs/concepts/modules">Modules</a></li>
                <li><a href="/docs/concepts/shortcodes">Shortcodes</a></li>
                <li><a href="/docs/concepts/pipelines">Pipelines</a></li>
                <li><a href="/docs/concepts/recipes">Recipes</a></li>
                <li><a href="/docs/concepts/themes">Themes</a></li>
                <li><a href="/docs/concepts/io">I/O</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/usage">Usage</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/usage/obtaining">Obtaining</a></li>
                <li><a href="/docs/usage/command-line">Command Line</a></li>
                <li><a href="/docs/usage/configuration">Configuration</a></li>
                <li><a href="/docs/usage/settings">Settings</a></li>
                <li><a href="/docs/usage/embedding">Embedding</a></li>
                <li><a href="/docs/usage/executing-in-a-unit-test">Executing In A Unit Test</a></li>
                <li><a href="/docs/usage/examples">Examples</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/deployment">Deployment</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/deployment/appveyor">AppVeyor for Continuous Integration</a></li>
                <li><a href="/docs/deployment/azure">Azure</a></li>
                <li><a href="/docs/deployment/netlify">Netlify</a></li>
                <li><a href="/docs/deployment/serving-from-a-subdirectory">Serving From A Subdirectory</a></li>
                <li><a href="/docs/deployment/ssl-and-https">SSL and HTTPS</a></li>
                <li><a href="/docs/deployment/cake">Using Cake</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/docs/extensibility">Extensibility</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/extensibility/creating-a-theme">Creating A Theme</a></li>
                <li><a href="/docs/extensibility/customizing-recipe-pipelines">Customizing Recipe Pipelines</a></li>
                <li><a href="/docs/extensibility/customizing-themes">Customizing Themes</a></li>
                <li class="selected"><a href="/docs/extensibility/writing-a-module">Writing a Module</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/advanced">Advanced</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/advanced/custom_document_types">Custom Document Types</a></li>
                <li><a href="/docs/advanced/document-content-streams">Document Content Streams</a></li>
                <li><a href="/docs/advanced/migrating-to-0.12.x">Migrating to 0.12.x</a></li>
                <li><a href="/docs/advanced/setting-the-culture">Setting The Culture</a></li>
                <li><a href="/docs/advanced/what_to_exclude_from_source_control">What To Exclude From Source Control</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/resources">Resources</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/docs/resources/some-background">Some Background</a></li>
                <li><a href="/docs/resources/built-with-wyam">Built With Wyam</a></li>
                <li><a href="/docs/resources/blog-posts">Blog Posts</a></li>
                <li><a href="/docs/resources/tools">Tools</a></li>
                <li><a href="/docs/resources/hosts">Hosts</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Writing a Module</h1>
		</section>
	<section class="content">
		<p>Writing a new module is easy and consists of four steps: creating a class library for your module, adding a module class, implementing a single method, and deploying the library.</p>
<h1 id="create-a-library">Create a Library</h1>
<p>Create a class library for your module and reference the latest <code>Wyam.Common</code> <a href="https://www.nuget.org/packages/Wyam.Common">NuGet package</a>. This includes all of the Wyam interfaces and should be the only package you need to include to extend Wyam.</p>
<h2 id="library-boundaries">Library Boundaries</h2>
<p>It is recommended that you aim for library separation based on dependencies. Wyam will eventually be packaged for multiple .NET runtimes and defining module libraries on dependency boundaries should make it easier to port those modules that support alternate platforms.</p>
<h2 id="naming">Naming</h2>
<p>Try to name your modules (and their containing libraries) based on <em>what they do</em> not <em>how they do it</em>. The names should also be short and concise. For example, if you write a module that manipulates Excel files, it should be called "Excel" not "ExcelDotNet" (assuming that was the name of a .NET Excel library) or "ExcelEditor".</p>
<h1 id="create-a-module-class">Create a Module Class</h1>
<p>Derive your class from <code><a href="/api/Wyam.Common.Modules/IModule">IModule</a></code>.</p>
<p>If your module needs any information, you'll typically get it in the constructor and then save it until execution. If your module needs to collect data at runtime, use either <code><a href="/api/Wyam.Common.Configuration/ContextConfig">ContextConfig</a></code> or <code><a href="/api/Wyam.Common.Configuration/DocumentConfig">DocumentConfig</a></code> as an argument in the constructor or fluent method and then evaluate it in your <code><a href="/api/Wyam.Core.Modules.Extensibility/Execute">Execute</a></code> method using <code>Invoke&lt;T&gt;</code>. Because both <code><a href="/api/Wyam.Common.Configuration/ContextConfig">ContextConfig</a></code> and <code><a href="/api/Wyam.Common.Configuration/DocumentConfig">DocumentConfig</a></code> return a raw <code>object</code> to make configuration easier, be sure to document somewhere what kind of return type your module expects from these delegates.</p>
<h1 id="implement-the-execute-method">Implement The Execute Method</h1>
<p>Implement the single method <code>IEnumerable&lt;<a href="/api/Wyam.Common.Documents/IDocument">IDocument</a>&gt; Execute(IReadOnlyList&lt;<a href="/api/Wyam.Common.Documents/IDocument">IDocument</a>&gt; inputs, <a href="/api/Wyam.Common.Execution/IExecutionContext">IExecutionContext</a> context)</code>. Your implementation should accept zero or more <code><a href="/api/Wyam.Common.Documents/IDocument">IDocument</a></code> inputs and return zero or more <code><a href="/api/Wyam.Common.Documents/IDocument">IDocument</a></code> outputs. To the extent you need to modify the input documents (which are immutable) or get new ones, use one of the <code><a href="/api/Wyam.Common.Execution/IExecutionContext/5797EAF5">IExecutionContext.GetDocument()</a></code> methods which return a new <code><a href="/api/Wyam.Common.Documents/IDocument">IDocument</a></code> with new content and/or additional metadata items.</p>
<p>Inside your <code><a href="/api/Wyam.Core.Modules.Extensibility/Execute">Execute</a></code> implementation, iterate over the <code><a href="/api/Wyam.Common.Documents/IDocument">IDocument</a></code> objects that were passed in. To access document content, use <code><a href="/api/Wyam.Common.Documents/IDocument/5B82D8DF">IDocument.GetStream()</a></code> or <code><a href="/api/Wyam.Common.Documents/IDocument/B37DBEEF">IDocument.Content</a></code>. Using streams is prefered when both reading and cloning documents because it can provide more direct access to the document content. However, you should prefer <code><a href="/api/Wyam.Common.Documents/IDocument/B37DBEEF">IDocument.Content</a></code> over using your own <code>MemoryStream</code> to buffer content from <code><a href="/api/Wyam.Common.Documents/IDocument/5B82D8DF">IDocument.GetStream()</a></code> if you need access to the content as a string. Also use one of the <code><a href="/api/Wyam.Common.Execution/IExecutionContext/5797EAF5">IExecutionContext.GetDocument()</a></code> overrides that takes a string instead of cloning with a <code>MemoryStream</code> if you already have the content as a string. Also note that if you use <code><a href="/api/Wyam.Common.Documents/IDocument/5B82D8DF">IDocument.GetStream()</a></code> <strong>you must dispose the returned stream</strong>.</p>
<h2 id="parallel-execution">Parallel Execution</h2>
<p>For performance reasons, modules are encouraged to perform their operations in parallel if possible. That's why the entire sequence of input documents gets passed to the <code>Execute()</code> method instead of just giving the module one at a time. The easiest way to do this is to use <code>.AsParallel()</code> in a LINQ expression or use <code>Parallel.ForEach()</code>, but any method is acceptable. Keep in mind that while intra-module operations are allowed to run in parallel, the pipeline is run sequentially on the main thread. This ensures that the order of pipelines and modules remains predictable and consistent.</p>
<h2 id="executing-child-modules">Executing Child Modules</h2>
<p>If you need to execute child modules from your module, don't call <code>IModule.Execute()</code> on each child module. Instead use one of the <code>IExecutionContext.Execute()</code> methods. They return the result documents from calling the child module chain (which can then be returned by your own module if needed).</p>
<h2 id="other-guidelines">Other Guidelines</h2>
<p>Here are a few other guidelines to follow so that your module matches the convention used by the built-in Wyam modules.</p>
<ul>
<li>Favor overloaded constructors over optional arguments. This will help avoid versioning problems in the future (see <a href="http://haacked.com/archive/2010/08/10/versioning-issues-with-optional-arguments.aspx/">this blog post</a> for more details).</li>
<li>Use a fluent interface for setting optional options and favor accepted fluent method naming conventions (I.e., use <code>WithSomeOption()</code> instead of <code>SetSomeOption()</code> unless you're actually setting something external to the module).</li>
<li>Try to make sure fluent methods are resilient against multiple calls if appropriate. I.e., if a fluent methods defines a set of something, make sure subsequent calls add to the set instead of replacing it. If the fluent method defines a predicate, make sure subsequent calls add conditions to the predicate instead of replacing it.</li>
<li>Make the module null and fault tolerant. That is, if null or other invalid values are supplied as constructor or fluent method arguments, try to work around it by using default values, etc. instead of throwing exceptions.</li>
<li>Favor flexibility and try to consider all the possible uses of your module. Even if you don't think anyone would use it in a certain way, try to support as many scenarios as possible.</li>
<li>Always process the input documents to a module. Don't rely on getting documents from the <code><a href="/api/Wyam.Common.Execution/IExecutionContext">IExecutionContext</a></code> except for reference or supplemental information.</li>
<li>Write tests if possible and include them if submitting your module to the official repository.</li>
<li>Consider using a <code>public static class</code> called <code>[LibraryName]Keys</code> with <code>public const string</code> members to store your metadata keys if your module generates metadata. This will help avoid the use of "magic strings" in configuration files and templates.</li>
<li>If you're planning on submitting your module, document it using XML code comments. Also use the special <code>category</code> and <code>metadata</code> XML comment elements (the Wyam web site knows how to read these and they power the <a href="/modules">modules</a> page).</li>
</ul>
<h1 id="deployment">Deployment</h1>
<p>Compile your library and place it somewhere Wyam will find it. You can manually put it in the Wyam directory (not recommended), tell Wyam to <a href="/docs/usage/configuration#assemblies">reference your assemblies</a>, or create a NuGet package and <a href="/docs/usage/configuration#nuget-packages">tell Wyam to use it</a>. In all of these deployment scenarios, Wyam will scan the assembly for any modules, find your new module, and make it available.</p>
<h1 id="example">Example</h1>
<p>As an example, here's the entirety of the <a href="/modules/where">Where</a> module, which filters the documents in the pipeline:</p>
<pre><code>public class <a href="/api/Wyam.Core.Modules.Control/Where">Where</a> : <a href="/api/Wyam.Common.Modules/IModule">IModule</a>
{
    private readonly <a href="/api/Wyam.Common.Configuration/DocumentConfig">DocumentConfig</a> _predicate;

    public Where(DocumentConfig predicate)
    {
        _predicate = predicate;
    }

    public IEnumerable&lt;<a href="/api/Wyam.Common.Documents/IDocument">IDocument</a>&gt; Execute(IReadOnlyList&lt;<a href="/api/Wyam.Common.Documents/IDocument">IDocument</a>&gt; inputs, <a href="/api/Wyam.Common.Execution/IExecutionContext">IExecutionContext</a> context)
    {
        return inputs.Where(x =&gt; _predicate.Invoke&lt;bool&gt;(x, context));
    }
}
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Wyam2 is maintained by <a href="https://savornicesei.com">Simona Avornicesei</a> and <a href="https://github.com/Wyam2/Wyam/graphs/contributors">other awesome contributors</a>, as a continuation of the <a href="https://github.com/Wyamio/Wyam">Wyam</a> project crafted by <a href="https://daveaglick.com">Dave Glick</a>. <a href="https://github.com/Wyam2/Wyam">Code on GitHub</a>. This site was entirely generated by Wyam. Check out <a href="https://github.com/Wyam2/docs">the site code on GitHub</a>.
<br><br>

            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        <div class="github-button">
    <a href="https://github.com/Wyam2/Wyam"><i class="fa fa-github"></i> GitHub</a>
</div>

        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>